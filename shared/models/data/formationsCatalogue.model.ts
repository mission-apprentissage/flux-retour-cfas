import type { CreateIndexesOptions, IndexSpecification } from "mongodb";
import { z } from "zod";
import { zObjectId } from "zod-mongodb-schema";

const collectionName = "formationsCatalogue";

const indexes: [IndexSpecification, CreateIndexesOptions][] = [
  [{ cle_ministere_educatif: 1 }, { name: "cle_ministere_educatif", unique: true }],
  [{ intitule_long: 1 }, { name: "intitule_long" }],
  [{ cfd: 1 }, { name: "cfd" }],
  [{ rncp_code: 1 }, { name: "rncp_code" }],
  [{ etablissement_formateur_siret: 1, etablissement_formateur_uai: 1 }, { name: "etablissement_formateur_siret_uai" }],
  [
    { etablissement_gestionnaire_siret: 1, etablissement_gestionnaire_uai: 1 },
    { name: "etablissement_gestionnaire_siret_uai" },
  ],
  [{ etablissement_formateur_uai: 1 }, { name: "etablissement_formateur_uai" }],
  [{ etablissement_gestionnaire_uai: 1 }, { name: "etablissement_gestionnaire_uai" }],
];

export const zFormationCatalogue = z.object({
  _id: zObjectId,
  cle_ministere_educatif: z.string(),
  cfd: z.string(),
  cfd_outdated: z.boolean(),
  cfd_date_fermeture: z.string().nullish(),
  nom_academie: z.string().nullish(),
  num_academie: z.string().nullish(),
  code_postal: z.string(),
  code_commune_insee: z.string(),
  num_departement: z.string().nullish(),
  nom_departement: z.string().nullish(),
  region: z.string().nullish(),
  localite: z.string().nullish(),
  nom: z.string().nullish(),
  intitule_long: z.string().nullish(),
  intitule_court: z.string().nullish(),
  diplome: z.string().nullish(),
  niveau: z.string().nullish(),
  onisep_url: z.string().nullish(),
  onisep_intitule: z.string().nullish(),
  onisep_libelle_poursuite: z.string().nullish(),
  onisep_lien_site_onisepfr: z.string().nullish(),
  onisep_discipline: z.string().nullish(),
  onisep_domaine_sousdomaine: z.string().nullish(),
  rncp_code: z.string().nullable(),
  rncp_intitule: z.string().nullish(),
  rncp_eligible_apprentissage: z.boolean().nullish(),
  rncp_details: z
    .object({
      date_fin_validite_enregistrement: z.string().nullish(),
      active_inactive: z.string().nullish(),
    })
    .nullish(),
  periode: z.array(z.string().nullish()).nullish(),
  duree: z.string(),
  duree_incoherente: z.boolean().nullish(),
  annee: z.string(),
  annee_incoherente: z.boolean().nullish(),
  published: z.boolean().nullish(),
  lieu_formation_adresse: z.string(),
  lieu_formation_siret: z.string().nullish(),
  id_formation: z.string(),
  libelle_court: z.string().nullish(),
  niveau_formation_diplome: z.string().nullish(),
  niveau_entree_obligatoire: z.number().nullable(),
  entierement_a_distance: z.boolean(),
  date_debut: z.array(z.string()).nullish(),
  date_fin: z.array(z.string()).nullish(),
  etablissement_gestionnaire_siret: z.string(),
  etablissement_gestionnaire_enseigne: z.string().nullish(),
  etablissement_gestionnaire_uai: z.string().nullable(),
  etablissement_gestionnaire_habilite_rncp: z.boolean().nullish(),
  etablissement_gestionnaire_certifie_qualite: z.boolean().nullish(),
  etablissement_gestionnaire_adresse: z.string().nullish(),
  etablissement_gestionnaire_code_postal: z.string().nullish(),
  etablissement_gestionnaire_code_commune_insee: z.string().nullish(),
  etablissement_gestionnaire_localite: z.string().nullish(),
  etablissement_gestionnaire_entreprise_raison_sociale: z.string().nullish(),
  etablissement_gestionnaire_region: z.string().nullish(),
  etablissement_gestionnaire_num_departement: z.string().nullish(),
  etablissement_gestionnaire_nom_academie: z.string().nullish(),
  etablissement_gestionnaire_num_academie: z.string().nullish(),
  etablissement_gestionnaire_date_creation: z.string().nullish(),
  etablissement_formateur_siret: z.string(),
  etablissement_formateur_enseigne: z.string().nullish(),
  etablissement_formateur_uai: z.string().nullable(),
  etablissement_formateur_habilite_rncp: z.boolean().nullish(),
  etablissement_formateur_certifie_qualite: z.boolean().nullish(),
  etablissement_formateur_adresse: z.string().nullish(),
  etablissement_formateur_code_postal: z.string().nullish(),
  etablissement_formateur_localite: z.string().nullish(),
  etablissement_formateur_entreprise_raison_sociale: z.string().nullish(),
  etablissement_formateur_date_creation: z.string().nullish(),
  created_at: z.string().nullish(),
});

export type IFormationCatalogue = z.output<typeof zFormationCatalogue>;

export default { zod: zFormationCatalogue, indexes, collectionName };
